[{"text":"function insertReleaseTicks(plot) {\n  plot.hooks.draw.push(function (plot, ctx) {\n    //$('.release').remove();\n    var graph = document.getElementById('graph');\n    [].slice.call(document.getElementsByClassName('release')).forEach(graph.removeChild.bind(graph));\n\n    ctx.save();\n\n    var off = plot.getPlotOffset();\n    ctx.translate(off.left, off.top);\n\n    ctx.strokeStyle = \"#888\";\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n\n    var xaxis = plot.getAxes().xaxis;\n    var plotHeight = plot.height();\n    var plotWidth = plot.width();\n\n    releaseDatesSafe = JSON.parse(JSON.stringify(releaseDates));\n\n    releaseDatesSafe.forEach(function (rdate) {\n      var x = xaxis.p2c(+new Date(rdate[0]));\n      rdate[0] = Math.floor(x) + 0.5;\n    });\n\n    releaseDatesSafe.forEach(function (rdate, index) {\n      var x = rdate[0];\n      var isLast = index + 1 >= releaseDatesSafe.length;\n      var nextx = isLast ? plotWidth : releaseDatesSafe[index + 1][0];\n      if (x >= plotWidth || (!isLast && nextx <= 0))\n        return;\n\n      if (x > 0 && x < plotWidth) {\n        ctx.moveTo(x, 0);\n        ctx.lineTo(x, plotHeight);\n      }\n\n      var label = $('<div class=\"release\"/>')\n        .text(rdate[1]).appendTo(\"#graph\");\n\n      var left = Math.max(0, x);\n      var right = Math.min(plotWidth, nextx);\n      var mid = left + ((right - left) / 2);\n      var labelmid = label.width() / 2;\n      label[0].style.left=(\"left\", (off.left + Math.max(left, mid - labelmid)) + \"px\");\n    });\n\n    ctx.stroke();\n    ctx.restore();\n  });\n}","diskText":""}]