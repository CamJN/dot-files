# no shebang

if JAVA_HOME=$(/usr/libexec/java_home 2>/dev/null); then
    export JAVA_HOME
    export MANPATH="$JAVA_HOME/man:$MANPATH"
fi
export NODE_REPL_HISTORY="$HOME/.history/node"
export PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true
export PYTHON_HISTORY="$HOME/.history/python"
# /Users/camdennarzt/.bun_repl_history
export RUBY_DEBUG_HISTORY_FILE="$HOME/.history/rdbg"
export SQLITE_HISTORY="$HOME/.history/sqlite"
export DOCKER_SCAN_SUGGEST=false
export DOTNET_GENERATE_ASPNET_CERTIFICATE=false
export DOTNET_ROOT="$(brew --prefix dotnet)/libexec"
export CUA_TELEMETRY_ENABLED=false

if [ "$(uname)" = "Darwin" ]; then
    SDKROOT=$(xcrun -sdk macosx --show-sdk-path)
    export SDKROOT

    # shellcheck disable=SC1090
    source <(brew shellenv)
    # cannot use ~/.config/homebrew/brew.env because the idiots don't allow variable substitution
    export HOMEBREW_INSTALL_BADGE=ðŸ·
    export HOMEBREW_AUTO_UPDATE_SECS=86400
    export HOMEBREW_NO_INSTALL_CLEANUP="Fuck off"
    export HOMEBREW_NO_ANALYTICS="Fuck off, seriously"
    export HOMEBREW_CACHE="$HOME/Library/Caches/Homebrew/"
    export HOMEBREW_UPDATE_TO_TAG="Homebrew devs suck"
    # export HOMEBREW_BUILD_FROM_SOURCE="Fuck off, forever"
    export HOMEBREW_BUNDLE_FILE="$HOME/Developer/Bash/dot-files/homebrew/Brewfile"
    export HOMEBREW_NO_BOTTLE_SOURCE_FALLBACK="fuck you"
    export HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK="rebuilding llvm for no reason? fuck you"
    HOMEBREW_BUNDLE_BREW_SKIP="$(grep -F ignore-dependencies "$HOMEBREW_BUNDLE_FILE" | awk '{print $2}' | tr -d '",')"
    export HOMEBREW_BUNDLE_BREW_SKIP
    export HOMEBREW_EVAL_ALL="lazy, cheap, fucking, asswipes"
    export HOMEBREW_USE_RUBY_FROM_PATH=1
    # have to specify the socket name because the shit-for-brains devs filter the env for the editor
    export HOMEBREW_EDITOR="${EDITOR} --socket-name ${EMACS_SOCKET_NAME}"
    export HOMEBREW_DOWNLOAD_CONCURRENCY=auto
    # /Users/camdennarzt/.brew_irb_history # move if possible in future
    # HOMEBREW_SSH_CONFIG_PATH # set to avoid having overrides in main git config

    # Setting SDKROOT breaks CPATH including `/usr/local/include` which it does by default
    export CPATH="$HOMEBREW_PREFIX/include"
    #MACOSX_DEPLOYMENT_TARGET=$(xcrun -sdk macosx --show-sdk-platform-version)
    export LIBRARY_PATH="$HOMEBREW_PREFIX/lib"
    export LD_LIBRARY_PATH=$LIBRARY_PATH
    # export DYLD_LIBRARY_PATH=$LIBRARY_PATH
    export GIT_CEILING_DIRECTORIES=/Users:/Users/camdennarzt/Developer
    export GIT_EDITOR="$EDITOR"
    #export CDPATH="$HOME/Developer"

    set -a
    # shellcheck disable=SC1090
    gpg-check && source <(gpg --quiet --decrypt ~/.bash.d/secrets.gpg)
    set +a

    export npm_package_config_node_gyp_devdir="${HOME}/Library/Caches/node-gyp"
    export npm_package_config_node_gyp_nodedir="${HOMEBREW_PREFIX}/opt/node/"

    declare OPENSSL_CONF
    OPENSSL_CONF="$(brew --prefix)/etc/openssl/openssl.cnf"
    export OPENSSL_CONF

    export GEM_SPEC_CACHE="$HOME/Library/Caches/RubyGems"
    if command -v rbenv > /dev/null; then
        declare RUBY_CONFIGURE_OPTS
        RUBY_CONFIGURE_OPTS="--with-openssl-dir=$(brew --prefix openssl@3) --enable-yjit"
        export RUBY_CONFIGURE_OPTS
        export RUBY_YJIT_ENABLE=1
        # shellcheck disable=SC1090
        source <(rbenv init -)
    fi

    function activate_swiftly {
        # shellcheck source=../../../../.config/swiftly/env.sh
        source "$HOME/.config/swiftly/env.sh"
    }
    # export SWIFT_FLAGS="--disable-xctest" # does nothing

    function activate_python {
        local PYVENV_PATH
        PYVENV_PATH=$(git ls-files --others --ignored --exclude-standard | rg 'pyvenv.cfg' | head -1 | xargs dirname)
        # shellcheck disable=SC1091
        source "${PYVENV_PATH:-"$PWD"}/bin/activate"
    }

    export PIP_DISABLE_PIP_VERSION_CHECK=1

    export GOPATH=~/Developer/Go
    declare GOROOT
    GOROOT="$(brew --prefix go)/libexec"
    export GOROOT
    export GOTOOLCHAIN=local
    declare RUSTUP_ROOT
    RUSTUP_ROOT="$(brew --prefix rustup)"
    declare CSHARP_TOOLS="$HOME/.dotnet/tools"
    export PATH="$PATH:$GOPATH/bin:$GOROOT/bin:$RUSTUP_ROOT/bin:$CSHARP_TOOLS"
    if [ -f ~/.cargo/env ]; then
        # shellcheck source=../../../../.cargo/env
        source ~/.cargo/env
    fi

    # supplementary .pc files
    export PKG_CONFIG_PATH=/usr/lib/pkgconfig
fi
