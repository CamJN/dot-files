#!/bin/bash

if [ -d ~/Applications/Emacs.app ]; then
    export PATH=~/Applications/Emacs.app/Contents/MacOS/bin:$PATH
    EMACS=~/Applications/Emacs.app/Contents/MacOS/Emacs
elif [[ `\emacs --version | head -1` == "GNU Emacs 24.1.1" ]]; then
    export TMPDIR=/tmp/
    EMACS='/usr/bin/emacs'
fi

if [[ -n $EMACS ]]; then
    export EMACS_SERVER_FILE=${TMPDIR}emacs`id -u`/server
    export EDITOR="emacsclient -t -s $EMACS_SERVER_FILE"

    if shlock -p $$ -f ~/.bash.d/emacs.lock; then
        if [ ! -e $EMACS_SERVER_FILE -o ! -S $EMACS_SERVER_FILE ]; then
            $EMACS --daemon 2>/dev/null
        fi
        rm  ~/.bash.d/emacs.lock;
    fi
else
    export EDITOR='emacsclient -nw "$@" 2>/dev/null'
    export ALTERNATE_EDITOR="\emacs"
fi

alias emacs="$EDITOR"
export GIT_EDITOR="`which emacsclient` -t -s $EMACS_SERVER_FILE"
alias emacs-save="emacsclient -e '(save-some-buffers t)' -s $EMACS_SERVER_FILE >/dev/null"
alias emacs-kill="emacsclient -e '(kill-emacs)' -s $EMACS_SERVER_FILE >/dev/null"

function emacsgive {
    emacsclient -e "(kill-new \"$*\")" -s $EMACS_SERVER_FILE >/dev/null
}
alias emacs-give='emacsgive';
