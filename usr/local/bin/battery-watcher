#!/bin/bash

declare full=$(pmset -g batt)
declare status=$(grep -wEoe '(not )?(dis)?charging' <<< $full)
declare -i percent=$(grep -Eoe '\d+%' <<< $full | tr -d %)
declare -i oldVolume=$(osascript -e 'output volume of (get volume settings)')
declare -i upper=81
declare -i lower=20

function mysay(){
    osascript -e "set volume without output muted"
    osascript -e "set volume 4"
   #say -v "Tessa" "[[volm 0.35]]$*"
    say -v "Tessa" "$*"
    osascript -e "set volume output volume $oldVolume"
}

function log() {
    echo -e "$*" >&2
}

log "status: $status percent: ${percent}%"

case "${status:-x}" in
    charging)
        if [ $percent -ge $upper ]; then
            mysay "battery charged"
        fi
        ;;
    discharging)
        if [ $percent -le $lower ]; then
            mysay "charge battery"
        fi
        ;;
esac

exit 0
