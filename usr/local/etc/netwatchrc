#!/usr/local/bin/bash

while [ -z "$interface" ]; do
interface=$(route -n get default 2>&- | fgrep interface | tr -d ' ' | cut -d: -f2)
done
nameserver=$(ipconfig getoption "$interface" domain_name_server)

if [ -z "$nameserver" ]; then
    nameserver=$(nslookup <<< server | fgrep Default | sed 's/Default server:/nameserver/g')
else
    nameserver="nameserver $nameserver"
fi

grep -Fq  "${nameserver:-nameserver 1.1.1.1}"   /usr/local/etc/dnsmasq.d/resolv-dnsmasq.conf || \
    echo "${nameserver:-nameserver 1.1.1.1}" > /usr/local/etc/dnsmasq.d/resolv-dnsmasq.conf

[ -r "$HOME/.netwatchrc" ] && . "$HOME/.netwatchrc"
